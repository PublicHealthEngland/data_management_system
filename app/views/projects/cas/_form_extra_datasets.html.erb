<fieldset>
  <legend>Extra Datasets</legend>
  <table class="table table-hover">
    <tbody>
      <thead>
        <tr>
          <th width="42%" style="border-top: 0px;">Dataset name</th>
          <th colspan="2" style="border-top: 0px;">Level 1</th>
          <th colspan="2" style="border-top: 0px;">Level 2</th>
          <th colspan="2" style="border-top: 0px;">Level 3</th>
        </tr>
      </thead>
        <%= form.fields_for :project_datasets, @project.project_datasets.sort_by { |x| x.dataset_id } do |pd| %>
          <tr>
            <%= pd.hidden_field :dataset_id, value: pd.object.dataset_id %>
            <td width="40%"><%= pd.object.dataset.name %></td>
              <%= pd.fields_for :project_dataset_levels, pd.object.project_dataset_levels.sort_by { |x| x.access_level_id } do |pdl| %>
                <% if pd.object.dataset.levels.include? pdl.object.access_level_id %>
                  <%= pdl.hidden_field :access_level_id, value: pdl.object.access_level_id %>
                  <td width="5%"><%= pdl.check_box :selected, readonly_value: check_icon(pdl.object.selected) %></td>
                  <td width="15%"><%= pdl.datepicker_field :expiry_date, placeholder: "Expiry date" %></td>
                <% else %>
                  <td></td>
                  <td></td>
                <% end %>
              <% end %>
          </tr>
        <% end %>
    </tbody>
  </table>
</fieldset>
