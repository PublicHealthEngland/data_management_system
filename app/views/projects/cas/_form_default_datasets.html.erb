<script>
  function clearcheckboxes(master){
    var master_checked = master.checked
    var defaultscheckboxarray = document.getElementsByClassName('defaults_checkbox');
    for(var i = 0; i < defaultscheckboxarray.length; i++){
      var role = document.getElementById(defaultscheckboxarray[i].id);
      role.checked = false;
      master.checked = master_checked;
    }
  }

  function togglecheckboxes(master,group){
    clearcheckboxes(master);
    var cbarray = document.getElementsByClassName(group);
    for(var i = 0; i < cbarray.length; i++){
      var cb = document.getElementById(cbarray[i].id);
      cb.checked = master.checked;
    }
  }
</script>

<fieldset>
  <legend>Role based dataset defaults</legend>
  <input type="checkbox" class="defaults_checkbox role_checkboxes" id="cancer_analyst" onchange="togglecheckboxes(this, 'ca_group')"> Cancer Analyst
  <input type="checkbox" class="defaults_checkbox role_checkboxes" id="developer" onchange="togglecheckboxes(this, 'd_group')"> Developer
  <input type="checkbox" class="defaults_checkbox role_checkboxes" id="qa" onchange="togglecheckboxes(this, 'qa_group')"> QA
</fieldset>

<fieldset>
  <legend>Default Datasets</legend>
  <table id="default_datasets" class="table table-hover">
    <thead>
      <tr>
        <th width="31%" style="text-align:center; border-top: 0px;">Dataset name</th>
        <th colspan="2" style="text-align:center; border-top: 0px;">Level 1</th>
        <th colspan="2" style="text-align:center; border-top: 0px;">Level 2</th>
        <th colspan="2" style="text-align:center; border-top: 0px;">Level 3</th>
      </tr>
    </thead>
    <tbody>
      <%= form.fields_for :project_datasets, @project.project_datasets.select { |dataset| Dataset.cas_defaults.pluck(:id).include? dataset.dataset_id }.sort_by(&:dataset_id) do |pd| %>
        <tr id="dataset_<%=pd.object.dataset.id=%>_row">
          <%= pd.hidden_field :dataset_id, value: pd.object.dataset_id %>
          <td width="31%" data-toggle="tooltip" data-placement="left" title="<%= pd.object.dataset.name %>">
            <%= truncate(pd.object.dataset.name) %>
          </td>
          <%= pd.fields_for :project_dataset_levels, pd.object.project_dataset_levels.sort_by(&:access_level_id) do |pdl| %>
            <% if pd.object.dataset.levels.include? pdl.object.access_level_id %>
              <%= pdl.hidden_field :access_level_id, value: pdl.object.access_level_id %>
              <td id="level_<%= pdl.object.access_level_id %>_selected" width="3%"><%= pdl.check_box :selected, class: check_box_class(pd.object.dataset.id, pdl.object.access_level_id), id: "dataset_#{pd.object.dataset.id}_level_#{pdl.object.access_level_id}_check_box", readonly_value: check_icon(pdl.object.selected) %></td>
              <td id="level_<%= pdl.object.access_level_id %>_expiry_date" width="20%"><%= pdl.datepicker_field :expiry_date, id: "level_#{pdl.object.access_level_id}_expiry_datepicker", placeholder: "Expiry date", readonly_value: display_level_date(pdl.object) %></td>
            <% else %>
              <td id="level_<%= pdl.object.access_level_id %>_selected"></td>
              <td id="level_<%= pdl.object.access_level_id %>_expiry_date" style="text-align:center;">-</td>
            <% end %>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</fieldset>
